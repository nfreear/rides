<!doctype html> <title> Ride map </title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css"
  integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
  crossorigin=""/>

<script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"
  integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og=="
  crossorigin=""></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/markdown-it/10.0.0/markdown-it.min.js"></script>

<style>
  #mapid { height: 680px; }
  #overlay { background: #fff; position: absolute; left: 3.6rem; top: 18px; x-height: 2rem; x-width: 7rem; padding: 5px 2px; border: 1px solid gray; z-index: 999; }
</style>


<div id="overlay"><a href="#summary">&darr; To summary</a></div>

<div id="mapid"> <p> Loading &hellip; </div>

<div id="summary"> ... </div>

<script>
const INDEX = {
  "zoom": 13,

  "locations": {
    "Broughton": [ 52.04788296483457, -0.6988184619694948 ],
    "Salford": [ 52.0421364, -0.6352302 ]
  },

  "rides": {
    "2019-10-27": {
      "title": "Marston Moretaine",
      "centre": "Salford",
      "geojson": "2019-10-27/2019-10-27-geojson.json",
      "summary": "2019-10-27/2019-10-27-summary.md"
    },

    "2020-07-13": {
      "title": "...",
      "centre": "Salford",
      "geojson": "2020-07-13/track.geojson.json",
      "summary": "2019-10-27-Marston-Moretaine/2019-10-27-summary.md"
    }
  }
}
</script>


<script>
  const L = window.L;
  const MD = window.markdownit();

  const M_ID = window.location.href.match(/\?d=(\d+-\d+-\d+)/);
  const DATE = M_ID ? M_ID[ 1 ] : '2019-10-27';

  const RIDE = INDEX.rides[ DATE ]; // RIDES_INDEX[ DATE ];
  const LATLNG = INDEX.locations[ RIDE.centre ];

  const GEOJSON_URL = `./data/${ RIDE.geojson }`;
  const SUMMARY_URL = `./data/${ RIDE.summary }`;

  const mymap = L.map('mapid').setView(LATLNG, INDEX.zoom);

  console.warn('Ride:', RIDE, LATLNG, GEOJSON_URL, mymap);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { // 'https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
  	attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
  	maxZoom: 18,
  	id: 'mapbox.streets',
  	accessToken: 'your.mapbox.access.token'
  }).addTo(mymap);

  async function loadGeoJson(geoJsonUrl) {
    const response = await window.fetch(geoJsonUrl); // './data/' + RIDE.geojson);
    console.warn('Response:', response);

    const featureData = await response.json();
    console.warn('Features:', featureData)

    const FEATURES_LINE = [ featureData.features[ 0 ] ];

    L.geoJSON(FEATURES_LINE).addTo(mymap);
  }

  async function loadSummary(url) {
    const response = await window.fetch(url);
    const markdown = await response.text();

    document.querySelector('#summary').innerHTML = MD.render(markdown);
  }

  loadGeoJson(GEOJSON_URL);
  // loadSummary(SUMMARY_URL);

  var popup = L.popup()
    // .setLatLng(latlng)
    .setContent('<p>Hello world!<br />This is a nice popup.</p>')
    .openOn(mymap);


</script>


<pre>


NDF / 27-Oct-2019.

 * https://leafletjs.com/reference-1.5.0.html#map-pane

</pre>
